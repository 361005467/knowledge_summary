# 进程 线程 协程

进程

- 运行中的程序

线程

- cpu 调度最小的单位，线程运行时会占用 cpu。 cpu 给每个线程分配时间片

协程

- 用户态调度任务，从而实现用同步的方式写异步代码

进程切换：

- 用户态切换到内核态
- 切换页表（虚拟地址对物理地址的映射）
- 切换寄存器状态

进程状态： 1. 创建 2 就绪 3 执行 4 阻塞 5 结束

并发

- 单 cpu 上，通过任务切换，多个任务可以交替运行，但任何时刻都只有一个任务被执行。例如单核 cpu 多线程调度，协程调度

并行

- 多 cpu 上，多个任务同时执行

用户态和内核态

- 权限限制
- 内核态和用户态之间的转换方式主要包括：系统调用，异常和中断。

进程通信

- 共享内存
  - 多个进程映射虚拟地址到同一块物理地址
  - 需要 semaphore 来加锁同步

虚拟地址

- 对用户来说，虚拟地址是连续，但物理地址可能是不连续的。用户直接操作虚拟地址更简单，
- 虚拟地址有更大空间，可以把数据置换到硬盘上，
- 进程内存隔离

进程内存结构

- 栈。 使用栈空间存储函数的返回地址、参数、局部变量、返回值
- 堆区。调用 new/malloc 函数时在堆区动态分配内存，同时需要调用 delete/free 来手动释放申请的内存。
- bss 段。 存储未初始化的全局变量和静态变量（局部+全局），以及所有被初始化为 0 的全局变量和静态变量。
- 数据段。 存储程序中已初始化的全局变量和静态变量
- 代码段。 字符串常量，机器代码。

fork

- 子进程中，成功的 fork( )调用会返回 0。在父进程中 fork( )返回子进程的 pid
- 写时复制

read

- 设备-》页缓存（内核）-》用户内存  
  顺序读

mmap

- 设备-》页缓存（内存） 用户进程直接读写页缓存
- 内核的地址块映射到用户的地址空间
